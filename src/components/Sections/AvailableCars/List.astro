---
import type { SanityDocument } from "@sanity/client";
import { loadQuery } from "@sanity/lib/load-query";

import Car from "@components/Sections/AvailableCars/Card.astro";

import SliderBtnsWrapper from "@components/UI/Slider/SliderBtnsWrapper.astro";
import SliderScrollbar from "@components/UI/Slider/SliderScrollbar.astro";
import LastSlide from "@components/UI/LastSlide.astro";

const { carousel = false, headingLevel, id, style, excludeSlug } = Astro.props;
const excludeFilter = excludeSlug ? `&& slug.current != $excludeSlug` : "";

const query = carousel
  ? `*[_type == "availableCars" ${excludeFilter}] | order(sold asc, _createdAt desc)[0...4]`
  : `*[_type == "availableCars"] | order(sold asc, _createdAt desc)`;

const { data: cars } = await loadQuery<SanityDocument[]>({
  query,
  params: excludeSlug ? { excludeSlug } : {},
});
---

<div data-carousel-wrapper={carousel || undefined}>
  <ul
    id={id}
    class:list={[carousel && "carousel", style]}
    data-carousel={carousel ? "with-scrollbar" : undefined}
  >
    {
      cars.map((car) => (
        <li>
          <Car {car} headingLevel={headingLevel} />
        </li>
      ))
    }

    {
      carousel && (
        <li>
          <LastSlide href="/available-cars" />
        </li>
      )
    }
  </ul>

  {
    carousel && (
      <>
        <SliderBtnsWrapper bigBtn />
        <SliderScrollbar />
      </>
    )
  }
</div>
