---
import SanityImg from "@components/Sanity/SanityImg.astro";
import SectionHeading from "@components/UI/SectionHeading.astro";
import Button from "@components/UI/Button.astro";
import SpecificationBadge from "@components/Sections/AvailableCars/SpecificationBadge.astro";
import SliderBtnsWrapper from "@components/UI/Slider/SliderBtnsWrapper.astro";

import FuelIcon from "@assets/svg/Specifications/Fuel.astro";
import TransmissionIcon from "@assets/svg/Specifications/Transmission.astro";
import OdometerIcon from "@assets/svg/Specifications/Odometer.astro";

const { car, headingLevel } = Astro.props;
---

<article
  class="card relative h-full overflow-hidden"
  data-element="available-car"
>
  <SectionHeading
    style="mb-0 text-[1.125em] text-balance"
    headingLevel={headingLevel}
  >
    <a
      class="stretched-link block leading-snug"
      href={`/available-cars/${car.slug.current}`}
    >
      {car.title}
    </a>
  </SectionHeading>

  <p
    class="line-clamp-3 text-white/78 max-md:leading-normal md:mt-auto md:text-[.875em]"
  >
    {car.description}
  </p>

  <dl
    class="flex flex-wrap gap-small pb-base max-md:mt-auto border-b border-b-semi-transparent md:text-[.875em]"
  >
    <SpecificationBadge
      details={car.odometer.toLocaleString("bg-BG").replace(/\s/g, "\u202F") +
        "\u202Fкм"}
    >
      <OdometerIcon />
    </SpecificationBadge>

    <SpecificationBadge details={car.fuelType}><FuelIcon /></SpecificationBadge>

    <SpecificationBadge details={car.transmission}>
      <TransmissionIcon />
    </SpecificationBadge>
  </dl>

  <dl class="flex justify-between gap-small py-small">
    <div class="">
      <dt>
        <span class="sr-only">Цена</span>
      </dt>
      <dd class="text-stroke">
        {car.price.toLocaleString("bg-BG").replace(/\s/g, "\u202F")}{" "}
        BGN
      </dd>
    </div>
    <div>
      <dt>
        <span class="sr-only">Град</span>
      </dt>
      <dd class="text-stroke">София</dd>
    </div>
  </dl>

  <div
    class="-order-1 relative overflow-hidden corner-shape-sm"
    data-carousel-wrapper
  >
    <div class="carousel aspect-[5/3]" data-carousel>
      {car.used && <div class="img-badge">Използвана</div>}

      {car.sold && <div class="img-badge">Продадена</div>}

      {
        car.gallery.slice(0, 5).map((item: any, i: number) =>
          i < 4 ? (
            <SanityImg
              image={item}
              alt={item.alttext || `Фото ${car.title} ${i + 1}`}
            />
          ) : (
            <div class="relative h-full flex items-center justify-center *:first:absolute *:first:-z-1 *:first:blur-md">
              <SanityImg
                image={item}
                alt={item.alttext || `Фото ${car.title} ${i + 1}`}
              />
              <Button
                href={`/available-cars/${car.slug.current}`}
                style="stretched-link"
                accentBtn
              >
                Виж повечe
              </Button>
            </div>
          )
        )
      }
    </div>
    <SliderBtnsWrapper style="imgs-carousel_btn-wrapper" />
  </div>
</article>
